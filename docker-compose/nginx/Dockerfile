FROM nginx
copy ./nginx.conf /etc/nginx/nginx.conf
copy ./jbpm /etc/nginx/sites-enabled/jbpm
copy ./grafana /etc/nginx/sites-enabled/grafana
copy ./prometheus /etc/nginx/sites-enabled/prometheus
# отказался от установки iptables, т.к. при попытке добавить правило появляется ошибка:
# iptables v1.8.9 (nf_tables): Could not fetch rule set generation id: Permission denied (you must be root)
# возможно, поможет установка 1.6 версии
#RUN apt update && apt install iptables -y
#RUN iptables -I FORWARD 1 -p tcp --dport 8080 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 8001 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 3000 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 80 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 9090 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 9100 -j ACCEPT && iptables -I FORWARD 1 -p tcp --dport 22 -j ACCEPT && iptables -P FORWARD DROP


